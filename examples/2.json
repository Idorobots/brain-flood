{
    "server" : {
    	"host" : "localhost",
	"port" : 8080,
	"endpoint" : "/socket.io/1/",

	"metadata" : {
	    "ping_timeout" : 5000
	}
    },
    
    "phases" : [
    	{
	    "name" : "Sample Phase I",
	    "users" : 20000,
	    "start_time" : 0,
	    "duration" : 300000,
	    "user_sessions" : ["Sample XHR-polling Session", "Sample WebSocket Session"],

	    "metadata" : {
	    	"session_timeout" : 3600000
	    }
	}
    ],
    
    "sessions" : [
	{
	    "name" : "Sample WebSocket Session",
	    "transport" : "websocket",
	    "weight" : 0.8,

	    "metadata" : {
		"event" : "ping",
		"args" : "WebSocket"
	    },

	    
	    "do" : [
		["start_timer", {"name" : "session_timeout", "time" : "$session_timeout"}],
		["on_timeout", {"name" : "session_timeout", "do" : [
		    ["log", {"format" : "Session timed out. Closing connection: ~s.",
			     "values" : ["$server.sid"]}],
		    ["terminate", {"reason" : "Session timed out."}]
		]}],

		["on_socketio", {"opcode" : "1", "do" : [
		    ["log", {"format" : "Connected ~s!",
			     "values" : ["$server.sid"]}],
		    ["start_timer", {"name" : "hb_timeout", "time" : "$server.heartbeat_timeout"}],
		    ["on_socketio", {"opcode" : "8", "do" : [
			["restart_timer", {"name" : "hb_timeout", "time" : "$server.heartbeat_timeout"}]
		    ]}],
		    ["on_socketio", {"opcode" : "5", "do" : [
		    	["restart_timer", {"name" : "hb_timeout", "time" : "$server.heartbeat_timeout"}]
		    ]}],
		    ["on_timeout", {"name" : "hb_timeout", "do" : [
			["terminate", {"reason" : "Didn't receive a heartbeat on time!"}]
		    ]}],

		    ["on_event", {"name" : "comet_error", "do" : [
			["match", {"re" : "{\"error\":\"(.*)\",\"description\":(.*)}",
				   "subject" : "$event.args",
				   "on_match" : [
				       ["log", {"format" : "Received a Comet error message ~s: ~s!",
						"values" : ["$match_0", "$match_1"]}]
				   ]}]
		    ]}]

		]}],

		["on_socketio", {"opcode" : "0", "do" : [
		    ["terminate", {"reason" : "shutdown"}]
		]}]
	    ]
	},
	{
	    "name" : "Sample XHR-polling Session",
	    "inherits" : ["Sample WebSocket Session"],

	    "transport" : "xhr_polling",
	    "weight" : 0.2,
	    "metadata" : {
		"args" : "XHR-polling"
	    },

	    "do" : []
	}
    ]
}
